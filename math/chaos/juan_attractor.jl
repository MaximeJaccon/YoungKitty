using GLMakie
using ProgressBars

Juan((x, y), a, b, c, d) = Point2f(cos(a*x)^2 - sin(b*y)^2, 2*cos(c*x)*sin(d*y))

function trajectory(fn, x0, y0, kargs...; n=1000)
    xy = zeros(Point2f, n + 1)
    xy[1] = Point2f(x0, y0)
    @inbounds for i in 1:n
        xy[i+1] = fn(xy[i], kargs...)
    end
    return xy
end

# Saved
# 0.7623860293700191, -0.6638578730949067, 1.8167801002094635, -2.7677186549504844
# -0.5228694979192676, -0.9284539056756749, 2.3944908873973123, -3.952794823095833
# -2.055921993333306, -0.4352422639689211, -2.887459351250202, 0.879294723964005
# -2.2986948655097725, 2.612948695757032, -0.0223484250452044, 2.094095590250962
# -0.09940275605962223, -0.6532460271266307, 2.808420454121957, -1.4503767141805897
# 2.433606524658459, -1.621896203171405, 2.473672782963628, -1.6665832433363383
# -2.74551508173358, 1.774802639700642, 1.901497837020874, -2.7905209784606626
# -2.6804101191501566, 0.9035729329193063, -0.9798376391347245, 1.4877420093019422
# -2.5935051083286, 1.5247087095145577, 0.21542230788172745, 1.682907625376699
# 2.597208051060445, 2.5253405087646525, -1.0266245789324215, 1.5749139817152216
# 2.723245294424415, 1.9510881571942225, 0.6914980922077918, 2.7713244423406733
# -1.619068919036977, 1.6475468475529897, -1.517167955762562, -2.5795363703687

fig = Figure(size=(1500, 1500))
ax = Axis(fig[1, 1]; backgroundcolor = RGBAf(0, 0, 0, 1))
cmap = to_colormap(:BuPu_9)
cmap[1] = RGBAf(1, 1, 1, 1) 

n_points = 10^6-1

points = trajectory(Juan, 0.1, 0.1, -1.619068919036977, 1.6475468475529897, -1.517167955762562, -2.5795363703687; n=n_points)
x_coords = [p[1] for p in points]
y_coords = [p[2] for p in points]

index = 1:n_points
frames= 1:2000

record(fig, "juan_attractor_animation.mp4", frames; framerate = 100) do i
    stop = i * 500
    start = stop - 499
    range = start:stop
    scatter!(
        ax, x_coords[range], y_coords[range], markersize=0.001, color=RGBAf(1, 1, 1, 1)
    )
end

